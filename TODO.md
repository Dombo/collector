## PRODUCTION BUGS

SSL doesn't work

```
Nov 02 12:12:02 c02 docker[6448]: panic: Post https://staging-api.pganalyze.com/v1/snapshots: write tcp 52.6.42.160:443: broken pipe
Nov 02 12:12:02 c02 docker[6448]: goroutine 1 [running]:
Nov 02 12:12:02 c02 docker[6448]: main.panicOnErr(0x7f8e5ccf9498, 0xc2094c0fc0)
Nov 02 12:12:02 c02 docker[6448]: /go/src/github.com/lfittl/pganalyze-collector-next/main.go:30 +0x50
Nov 02 12:12:02 c02 docker[6448]: main.main()
Nov 02 12:12:02 c02 docker[6448]: /go/src/github.com/lfittl/pganalyze-collector-next/main.go:181 +0x33e
Nov 02 12:12:02 c02 docker[6448]: goroutine 5 [syscall]:
Nov 02 12:12:02 c02 docker[6448]: os/signal.loop()
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/os/signal/signal_unix.go:21 +0x1f
Nov 02 12:12:02 c02 docker[6448]: created by os/signal.initÂ·1
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/os/signal/signal_unix.go:27 +0x35
Nov 02 12:12:02 c02 docker[6448]: goroutine 17 [syscall, locked to thread]:
Nov 02 12:12:02 c02 docker[6448]: runtime.goexit()
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/runtime/asm_amd64.s:2232 +0x1
Nov 02 12:12:02 c02 docker[6448]: goroutine 6 [runnable]:
Nov 02 12:12:02 c02 docker[6448]: database/sql.(*DB).connectionOpener(0xc20802afa0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/database/sql/sql.go:589 +0x4c
Nov 02 12:12:02 c02 docker[6448]: created by database/sql.Open
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/database/sql/sql.go:452 +0x31c
Nov 02 12:12:02 c02 docker[6448]: goroutine 11 [runnable]:
Nov 02 12:12:02 c02 docker[6448]: net.(*pollDesc).Wait(0xc2080107d0, 0x72, 0x0, 0x0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/net/fd_poll_runtime.go:84 +0x47
Nov 02 12:12:02 c02 docker[6448]: net.(*pollDesc).WaitRead(0xc2080107d0, 0x0, 0x0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/net/fd_poll_runtime.go:89 +0x43
Nov 02 12:12:02 c02 docker[6448]: net.(*netFD).Read(0xc208010770, 0xc208055000, 0x400, 0x400, 0x0, 0x7f8e5cf8cc88, 0xc2094c8380)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/net/fd_unix.go:242 +0x40f
Nov 02 12:12:02 c02 docker[6448]: net.(*conn).Read(0xc20802c058, 0xc208055000, 0x400, 0x400, 0x0, 0x0, 0x0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/net/net.go:121 +0xdc
Nov 02 12:12:02 c02 docker[6448]: crypto/tls.(*block).readFromUntil(0xc20803b170, 0x7f8e5cf8e228, 0xc20802c058, 0x5, 0x0, 0x0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/crypto/tls/conn.go:454 +0xe6
Nov 02 12:12:02 c02 docker[6448]: crypto/tls.(*Conn).readRecord(0xc2080b0580, 0x17, 0x0, 0x0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/crypto/tls/conn.go:539 +0x2da
Nov 02 12:12:02 c02 docker[6448]: crypto/tls.(*Conn).Read(0xc2080b0580, 0xc2080af000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/crypto/tls/conn.go:904 +0x166
Nov 02 12:12:02 c02 docker[6448]: net/http.noteEOFReader.Read(0x7f8e5cf8e2b0, 0xc2080b0580, 0xc209b90058, 0xc2080af000, 0x1000, 0x1000, 0x7f8e5cf7b010, 0x0, 0x0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/net/http/transport.go:1270 +0x6e
Nov 02 12:12:02 c02 docker[6448]: net/http.(*noteEOFReader).Read(0xc2094c6c20, 0xc2080af000, 0x1000, 0x1000, 0xc207ffd3f6, 0x0, 0x0)
Nov 02 12:12:02 c02 docker[6448]: <autogenerated>:125 +0xd4
Nov 02 12:12:02 c02 docker[6448]: bufio.(*Reader).fill(0xc2099b0ba0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/bufio/bufio.go:97 +0x1ce
Nov 02 12:12:02 c02 docker[6448]: bufio.(*Reader).Peek(0xc2099b0ba0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/bufio/bufio.go:132 +0xf0
Nov 02 12:12:02 c02 docker[6448]: net/http.(*persistConn).readLoop(0xc209b90000)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/net/http/transport.go:842 +0xa4
Nov 02 12:12:02 c02 docker[6448]: created by net/http.(*Transport).dialConn
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/net/http/transport.go:660 +0xc9f
Nov 02 12:12:02 c02 docker[6448]: goroutine 12 [runnable]:
Nov 02 12:12:02 c02 docker[6448]: net/http.(*persistConn).writeLoop(0xc209b90000)
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/net/http/transport.go:945 +0x41d
Nov 02 12:12:02 c02 docker[6448]: created by net/http.(*Transport).dialConn
Nov 02 12:12:02 c02 docker[6448]: /usr/lib/go/src/net/http/transport.go:661 +0xcbc
```

## Basic working version

* [X] Use pganalyze-collector JSON format
* [X] Run queries at 10 minute interval
* [X] DB: Indices
* [X] DB: Columns
* [X] Dockerfile
* [X] Exclude marked queries from output


## Solve existing pganalyze-collector use cases

* [ ] Generate configuration file
* [ ] Use statistics helper if it exists
* [ ] Create pg_stat_statements extension if it exists
* [ ] Use version detection to fetch correct fields
* [X] Compress sent data using zlib
* [ ] System information
* [ ] Option to not collect view statistics
* [ ] DB: Bloat, bgwriter, replication, locks, functions, settings
* [ ] DB: View definitions
* [ ] DB: Constraints


## Neat things

* [ ] Include normalized query in backends information


## Proxy

* [ ] HTTP API


---

=> Shared library that can be used by collector, proxy and API (for interface definition)
